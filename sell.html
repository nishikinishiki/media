<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>匿名売却価格シミュレーター（デモ）</title>
    <!-- Tailwind CSSの読み込み -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans JP', 'sans-serif'],
                    },
                    colors: {
                        primary: '#0067c0', // ブランドカラー（青系）
                        'primary-light': '#e0f2ff',
                        'success-dark': '#065f46',
                    }
                }
            }
        }
    </script>
    <style>
        /* カスタムスタイル */
        .shadow-primary {
            box-shadow: 0 4px 15px rgba(0, 103, 192, 0.2);
        }
        .animate-spin-slow {
            animation: spin 3s linear infinite;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans">

    <!-- ➀ヘッダー -->
    <header class="bg-white shadow-md sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-primary">すまい査定 (DEMO)</h1>
            <nav class="hidden sm:block">
                <a href="#" class="text-gray-600 hover:text-primary transition duration-150 mr-6">査定とは</a>
                <a href="#" class="text-gray-600 hover:text-primary transition duration-150">ご利用ガイド</a>
            </nav>
        </div>
    </header>

    <main class="max-w-4xl mx-auto p-4 sm:p-6 lg:p-8">
        <div class="text-center mb-10">
            <h2 class="text-3xl font-extrabold text-gray-900 mb-2">匿名・無料の想定売却価格シミュレーション</h2>
            <p class="text-gray-600">いくつかの情報を入力するだけで、現在の市場に基づいた売却価格の目安をシミュレーションします。</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- ②入力フォーム (Col 1 & 2) -->
            <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                <form id="assessmentForm" onsubmit="handleAssessment(event)">
                    <h3 class="text-xl font-semibold mb-6 text-gray-800 border-b pb-2">物件情報の入力</h3>
                    
                    <!-- マンション名 -->
                    <div class="mb-4">
                        <label for="mansionName" class="block text-sm font-medium text-gray-700 mb-1">マンション名 <span class="text-red-500">*必須</span></label>
                        <input type="text" id="mansionName" placeholder="例: 広尾ガーデンヒルズ" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary transition duration-150" value="青山タワーレジデンス">
                    </div>

                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <!-- 専有面積 -->
                        <div>
                            <label for="area" class="block text-sm font-medium text-gray-700 mb-1">専有面積 (㎡) <span class="text-red-500">*必須</span></label>
                            <input type="number" id="area" min="20" max="300" placeholder="例: 80.5" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary transition duration-150" value="84.57">
                        </div>

                        <!-- 階数 -->
                        <div>
                            <label for="floor" class="block text-sm font-medium text-gray-700 mb-1">所在階 (階) <span class="text-red-500">*必須</span></label>
                            <input type="number" id="floor" min="1" max="60" placeholder="例: 15" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary transition duration-150" value="19">
                        </div>
                    </div>

                    <div class="grid grid-cols-3 gap-4 mb-6">
                        <!-- 間取り -->
                        <div>
                            <label for="layout" class="block text-sm font-medium text-gray-700 mb-1">間取り <span class="text-red-500">*必須</span></label>
                            <select id="layout" required class="w-full p-3 border border-gray-300 bg-white rounded-lg focus:ring-primary focus:border-primary transition duration-150">
                                <option value="1LDK">1LDK</option>
                                <option value="2LDK">2LDK</option>
                                <option value="3LDK" selected>3LDK</option>
                                <option value="4LDK">4LDK</option>
                                <option value="その他">その他</option>
                            </select>
                        </div>
                        
                        <!-- 方位（任意） -->
                        <div>
                            <label for="direction" class="block text-sm font-medium text-gray-700 mb-1">主な方位 (任意)</label>
                            <select id="direction" class="w-full p-3 border border-gray-300 bg-white rounded-lg focus:ring-primary focus:border-primary transition duration-150">
                                <option value="">選択しない</option>
                                <option value="南">南</option>
                                <option value="東">東</option>
                                <option value="西">西</option>
                                <option value="北">北</option>
                                <option value="南東">南東</option>
                                <option value="南西">南西</option>
                            </select>
                        </div>

                        <!-- 角部屋（任意） -->
                        <div class="flex items-end h-full">
                            <div class="flex items-center p-3 border border-gray-300 bg-gray-50 rounded-lg w-full h-fit">
                                <input id="corner" type="checkbox" class="h-4 w-4 text-primary rounded border-gray-300 focus:ring-primary">
                                <label for="corner" class="ml-2 block text-sm font-medium text-gray-700 select-none">角部屋である</label>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="w-full bg-primary hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2">
                        価格を見る
                    </button>
                </form>
            </div>

            <!-- 査定の根拠説明 (Col 3) -->
            <div class="lg:col-span-1 bg-primary-light p-6 rounded-xl shadow-lg border border-primary/50 self-start">
                <h3 class="text-lg font-bold text-primary mb-3 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    データ作成の根拠
                </h3>
                <p class="text-sm text-gray-700 leading-relaxed">本シミュレーションの基となる査定ロジックは、国土交通省「不動産情報ライブラリ」等の公的データを利用する想定で設計されています。</p>
                <p class="mt-4 text-xs text-gray-500">
                    ※本デモは、実際のAPI接続は行わず、<span class="font-bold text-gray-700">フロントエンドのモックデータ</span>で結果をシミュレーションしています。
                </p>
            </div>
        </div>


        <!-- 出力結果セクション -->
        <div id="resultsSection" class="mt-12 hidden">
            <div id="loadingIndicator" class="text-center py-10 hidden">
                <svg class="animate-spin-slow h-10 w-10 text-primary mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <p class="mt-3 text-primary font-medium">査定値をシミュレーション中...</p>
            </div>

            <div id="assessmentResult" class="hidden">
                <h3 class="text-2xl font-bold text-gray-900 mb-6 border-b pb-2">査定結果: <span id="assessedMansionName" class="text-primary"></span></h3>
                
                <!-- 想定売却価格と㎡単価 -->
                <div class="bg-white p-6 rounded-xl shadow-primary mb-8 border-l-4 border-primary">
                    <p class="text-lg text-gray-600">あなたの物件の <span class="font-bold text-primary">想定売却価格</span></p>
                    <div class="flex items-baseline mt-1 mb-3">
                        <span id="estimatedPrice" class="text-5xl font-extrabold text-primary"></span>
                        <span class="text-2xl font-semibold text-primary ml-2">万円</span>
                    </div>
                    <p class="text-sm text-gray-500">㎡当たりの価格: <span id="pricePerSqm" class="font-semibold text-gray-700"></span> 万円/㎡</p>
                </div>

                <!-- 売却実績テーブル -->
                <div class="mb-8">
                    <h4 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-success-dark" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v14m-9 4h9a2 2 0 002-2v-3.5a2 2 0 00-2-2H9v5z"></path></svg>
                        <span id="jissekiMansionName"></span>の売却実績 (直近データ)
                    </h4>
                    <div class="overflow-x-auto bg-white rounded-lg shadow-md">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">所在階</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">売却価格</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">間取り</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">専有面積</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">売却時期</th>
                                </tr>
                            </thead>
                            <tbody id="salesRecords" class="bg-white divide-y divide-gray-200">
                                <!-- データがここに挿入される -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 売却した場合の費用 -->
                <div>
                    <h4 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8V9.75M12 16v.25M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        <span id="costMansionName"></span>を売却した場合の費用（概算）
                    </h4>
                    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
                        <p class="mb-3 text-gray-600">想定売却価格 (<span id="costBasePrice"></span>万円) に基づく費用概算です。</p>
                        <ul class="space-y-2 text-gray-700">
                            <li class="flex justify-between border-b border-dashed pb-1">
                                <span>仲介手数料 (売買価格の3% + 6万円 + 税)</span>
                                <span class="font-semibold text-red-600">- <span id="brokerFee"></span>万円</span>
                            </li>
                            <li class="flex justify-between border-b border-dashed pb-1">
                                <span>印紙代 (契約金額による)</span>
                                <span>- 1万円</span>
                            </li>
                            <li class="flex justify-between border-b border-dashed pb-1">
                                <span>その他 (登記費用・ローン一括返済費用など)</span>
                                <span>- 約50万円</span>
                            </li>
                            <li class="flex justify-between pt-2 border-t font-bold">
                                <span>手取り概算 (費用控除後)</span>
                                <span id="netHand"></span>万円
                            </li>
                        </ul>
                        <p class="mt-4 text-xs text-gray-500">※費用は概算であり、ローン残債や各種控除は考慮していません。詳細は専門家にご相談ください。</p>
                    </div>
                </div>
            </div>
            
            <div id="errorMessage" class="hidden mt-10 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg text-center" role="alert">
                <p>査定に失敗しました。サーバーとの接続を確認してください。</p>
            </div>
        </div>

    </main>

    <script>
        /**
         * バックエンドAPIの動作をシミュレートし、JSONデータを返します。（モック関数）
         */
        function simulateBackendApi(input) {
            // モック結果の計算ロジック
            let basePrice = 20000; 
            if (input.area > 80) basePrice += 1500;
            if (input.floor > 10) basePrice += 3000;
            if (input.isCorner) basePrice += 500;
            if (input.direction === '南') basePrice += 1000;
            
            // 最終想定価格（万円、10万円単位で丸め）
            const calculatedPrice = Math.round(basePrice * (input.area / 70) * 1.5 / 10) * 10;
            
            const pricePerSqmValue = (calculatedPrice * 10000 / input.area / 10000); // 万円/㎡

            // 仲介手数料の計算 (3% + 6万円 + 税)
            const taxRate = 0.10; // 消費税10%
            const feeBase = calculatedPrice * 0.03 + 6; // 万円
            const brokerFeeValue = Math.round(feeBase * (1 + taxRate));

            // その他の費用（概算）
            const otherCost = 50; // 50万円
            const stampDuty = 1; // 印紙代 1万円

            // 手取り概算
            const netHandValue = calculatedPrice - brokerFeeValue - stampDuty - otherCost;

            const salesRecords = generateMockRecords(input.mansionName, calculatedPrice);

            return {
                mansionName: input.mansionName,
                estimatedPrice: calculatedPrice,
                pricePerSqm: pricePerSqmValue,
                brokerFee: brokerFeeValue,
                netHand: netHandValue,
                salesRecords: salesRecords,
            };
        }


        /**
         * 査定結果に近い架空の売却実績データを生成するヘルパー関数
         */
        function generateMockRecords(mansionName, basePrice) {
            const records = [];
            const layouts = ['3LDK', '2LDK', '4LDK', '3LDK'];
            const areas = [84.57, 73.04, 95.12, 78.80];
            const floors = [19, 6, 25, 12];
            const dates = ['2025年05月', '2025年01月', '2024年11月', '2024年08月'];
            const priceFactors = [1.2, 0.9, 1.3, 0.8]; // 基準価格からの係数
            
            for (let i = 0; i < 4; i++) {
                const price = Math.round(basePrice * priceFactors[i] / 100) * 100; // 100万円単位に丸め
                const area = areas[i];
                const pricePerSqm = (price * 10000 / area / 10000);
                
                records.push({
                    floor: floors[i],
                    price: price, // 万円
                    layout: layouts[i],
                    area: area.toFixed(2), // ㎡
                    pricePerSqm: pricePerSqm, // 万円/㎡
                    date: dates[i]
                });
            }

            // 売却価格が高い順にソート
            return records.sort((a, b) => b.price - a.price);
        }

        /**
         * フォームの送信を処理し、査定結果を取得・表示します。
         */
        async function handleAssessment(event) {
            event.preventDefault();

            // フォームデータの取得
            const mansionName = document.getElementById('mansionName').value;
            const area = parseFloat(document.getElementById('area').value);
            const floor = parseInt(document.getElementById('floor').value, 10);
            const layout = document.getElementById('layout').value;
            const direction = document.getElementById('direction').value;
            const isCorner = document.getElementById('corner').checked;

            const resultsSection = document.getElementById('resultsSection');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const assessmentResult = document.getElementById('assessmentResult');
            const errorMessage = document.getElementById('errorMessage');

            // UIをリセットし、ローディングを開始
            resultsSection.classList.remove('hidden');
            assessmentResult.classList.add('hidden');
            errorMessage.classList.add('hidden');
            loadingIndicator.classList.remove('hidden');
            
            // 結果表示位置までスクロール
            window.scrollTo({ top: resultsSection.offsetTop - 20, behavior: 'smooth' });

            try {
                // 擬似的なネットワーク遅延
                await new Promise(resolve => setTimeout(resolve, 1500));

                // バックエンドからのレスポンスをシミュレーション
                const apiResponse = simulateBackendApi({mansionName, area, floor, layout, direction, isCorner});
                
                const {
                    estimatedPrice,
                    pricePerSqm,
                    brokerFee,
                    netHand,
                    salesRecords,
                    mansionName: responseMansionName
                } = apiResponse;

                // ------------------------------------------------------------------
                // UIへの結果反映
                // ------------------------------------------------------------------
                
                // 1. 想定売却価格と㎡単価
                document.getElementById('assessedMansionName').textContent = responseMansionName;
                document.getElementById('estimatedPrice').textContent = estimatedPrice.toLocaleString();
                // 小数点以下2桁表示に整形
                document.getElementById('pricePerSqm').textContent = pricePerSqm.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                
                // 2. 売却実績
                document.getElementById('jissekiMansionName').textContent = responseMansionName;
                const salesRecordsBody = document.getElementById('salesRecords');
                salesRecordsBody.innerHTML = salesRecords.map(record => {
                    const pricePerSqmFormatted = record.pricePerSqm.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                    return `
                        <tr class="hover:bg-gray-50">
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${record.floor}階</td>
                            <td class="px-6 py-4 whitespace-nowrap text-base font-medium text-primary">${record.price.toLocaleString()}万円</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${record.layout}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${record.area}㎡ (${pricePerSqmFormatted}万円/㎡)</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${record.date}</td>
                        </tr>
                    `;
                }).join('');

                // 3. 売却した場合の費用
                document.getElementById('costMansionName').textContent = responseMansionName;
                document.getElementById('costBasePrice').textContent = estimatedPrice.toLocaleString();
                document.getElementById('brokerFee').textContent = brokerFee.toLocaleString();
                document.getElementById('netHand').textContent = netHand.toLocaleString();


                // ローディングを非表示にし、結果を表示
                loadingIndicator.classList.add('hidden');
                assessmentResult.classList.remove('hidden');

            } catch (error) {
                console.error('査定シミュレーションエラー:', error);
                loadingIndicator.classList.add('hidden');
                errorMessage.classList.remove('hidden');
            }
        }

        // 初期表示時にもスクリプトを実行してイベントリスナーを設定
        document.addEventListener('DOMContentLoaded', () => {
            // 特に初期化処理は不要だが、フォームの入力例を反映
        });

    </script>
</body>
</html>